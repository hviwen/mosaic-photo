## P0 修复方案：铺满无缝、无重叠、裁剪缩放拖动条、选中信息增强

### 摘要
1. 修复画布边缘未填满与图片间隙：将铺满布局的“缩放夹持+回退裁剪”改为“严格按 tile 精确贴合”，并增加布局结果校验与兜底。  
2. 修复个别图片边缘重叠：同一套精确贴合策略同时约束重叠问题，主线程与 Worker 逻辑保持一致。  
3. 裁剪缩放交互改为拖动条：移除裁剪模式下 Shift+滚轮与“放大/缩小按钮”入口，仅保留右侧滑条（`100%~400%`）。  
4. 右侧“当前选中”信息增强：同时展示原图信息、用户裁剪信息、当前显示裁剪信息，宽高比统一保留 2 位小数。  

### 当前代码事实（已确认）
1. 铺满布局核心在 `/Users/pan/hankins/native/mosaic-photo/src/composables/useLayout.ts` 与 `/Users/pan/hankins/native/mosaic-photo/src/workers/layoutWorker.ts`，存在 `FILL_MIN_SCALE/FILL_MAX_SCALE` 与“目标裁剪尺寸回退”分支。  
2. 裁剪缩放当前入口是 `SidebarRight` 的按钮事件 + `CanvasStage` 的 `Shift + wheel` 分支。  
3. “当前选中”目前仅展示 `imageWidth/imageHeight` 与 `crop`，未展示原图 `sourceWidth/sourceHeight`、比例、以及 `layoutCrop` 口径。  
4. 当前仓库 `vitest` 用例通过，但 `typecheck` 里有与本需求无关的既有告警：`findHandleAt` 未使用。  

### 实施方案（可直接执行）

### 1) P0：铺满边缘不满/间隙（无缝覆盖）
1. 在 `/Users/pan/hankins/native/mosaic-photo/src/composables/useLayout.ts` 和 `/Users/pan/hankins/native/mosaic-photo/src/workers/layoutWorker.ts` 的 `fillArrangePhotos*` 中，移除铺满路径对 `scale` 的上下限夹持逻辑影响（不再让 `FILL_MIN_SCALE/FILL_MAX_SCALE` 改变 tile 贴合结果）。  
2. 统一采用“精确贴合”计算：`scale = tile.w / crop.width`，并保证 `crop` 宽高比与 `tile` 一致（由 `centerCropToAspect(ta)` 保证），使目标绘制矩形严格等于 tile。  
3. 删除或禁用会导致“尺寸退化到 base 上限”的回退分支（即会造成 draw 宽高小于 tile 的分支），避免出现画布露底间隙。  
4. 保留 `splitLength` 的整像素切分策略，保证 tile 之和精确覆盖画布边界。  

### 2) P0：个别图片边缘重叠
1. 复用第 1 项“精确贴合”后，理论上同一 tile 网格不会再出现重叠。  
2. 在布局输出后新增轻量校验函数（主线程与 Worker 同逻辑）：检查每个 placement 的目标绘制矩形是否落在画布内、面积总和与画布面积误差在阈值内、两两重叠面积不超过 epsilon。  
3. 若校验失败，触发 deterministic fallback（固定 seed 的网格切分 + 重新分配）并重新校验，保证生产路径可兜底。  

### 3) P0：裁剪缩放改拖动条，移除 Shift+滚轮与按钮
1. `SidebarRight` 改造（`/Users/pan/hankins/native/mosaic-photo/src/components/SidebarRight.vue`）：  
- 删除“放大/缩小”按钮和“支持 Shift + 鼠标滚轮缩放”提示。  
- 新增裁剪缩放 `v-slider`（范围 `100~400`，步长 `1`），显示当前百分比文本。  
- 继续保留“确认/取消”按钮。  
2. `CanvasStage` 改造（`/Users/pan/hankins/native/mosaic-photo/src/components/CanvasStage.vue`）：  
- 删除 `handleWheel` 中 `store.cropModePhotoId && e.shiftKey` 的裁剪缩放分支。  
- 删除 `CROP_ZOOM_IN_EVENT`、`CROP_ZOOM_OUT_EVENT` 常量和监听器。  
- 新增单一“设置裁剪缩放百分比”的事件或 store 通道（建议沿用现有事件桥，改成 `CustomEvent<{ percent:number }>`）。  
- 新增 `setCropZoomPercent(percent)`：将百分比映射为 `cropDraft.width = initialCropDraft.width * (100/percent)`，高度按固定框比例计算，再走现有 clamp。  
3. 文案同步：  
- `SidebarRight` 进入裁剪提示改为“拖动图片内容调整裁剪，使用滑条缩放，Enter 确认，Esc 取消”。  
- `CanvasStage` 顶部裁剪提示去掉 Shift+滚轮描述。  

### 4) P0：右侧“当前选中”信息增强
1. 在 `/Users/pan/hankins/native/mosaic-photo/src/components/SidebarRight.vue` 新增计算字段：  
- 原图尺寸：`sourceWidth/sourceHeight`，为空时回退 `imageWidth/imageHeight`。  
- 原图比例：`(w/h).toFixed(2)`。  
- 用户裁剪尺寸与比例：基于 `crop`。  
- 当前显示裁剪尺寸与比例：基于 `layoutCrop ?? crop`。  
2. 展示格式：  
- 原图：`宽 × 高`，比例 `x.xx`。  
- 用户裁剪：`宽 × 高`，比例 `x.xx`。  
- 显示裁剪：`宽 × 高`，比例 `x.xx`。  
3. 尺寸显示策略：  
- 原图尺寸显示整数。  
- 裁剪尺寸显示到 2 位小数（避免小数裁剪信息丢失）。  

### 5) 主线程/Worker 一致性
1. 任何铺满布局逻辑变更必须双写到：  
- `/Users/pan/hankins/native/mosaic-photo/src/composables/useLayout.ts`  
- `/Users/pan/hankins/native/mosaic-photo/src/workers/layoutWorker.ts`  
2. 如果存在共享逻辑（目前已有 `/Users/pan/hankins/native/mosaic-photo/src/utils/fillArrangeAssignment.ts`），优先复用，避免两端行为漂移。  

### 公共 API / 接口 / 类型影响
1. 对外项目文件结构与持久化 schema 不变。  
2. 内部事件接口会变化：移除 `mosaic:crop-zoom-in/out`，新增单一“设置裁剪缩放百分比”事件（或等价 store 通道）。  
3. 若使用 store 通道，新增轻量裁剪缩放状态字段（仅 UI 同步用途），不影响工程文件存储。  

### 测试与验收

### 自动化测试
1. 更新 `/Users/pan/hankins/native/mosaic-photo/test/fillArrange.layout.test.ts`：  
- 增加多组 seed/照片数场景（例如 10、30、80、120 张）覆盖断言：无空白覆盖、无重叠、边界内。  
2. 新增 `/Users/pan/hankins/native/mosaic-photo/test/fillArrange.stress.test.ts`：  
- 批量随机比例输入下验证面积覆盖误差与重叠阈值。  
3. 更新 `/Users/pan/hankins/native/mosaic-photo/test/fillArrange.aspect-policy.test.ts`：  
- 保持方向不反转约束与成本约束回归。  
4. 新增 `SidebarRight` 组件测试（如项目现状不便写 VTU，可先写纯函数单测）：  
- 原图/用户裁剪/显示裁剪三组信息和比例格式（2 位小数）正确。  
5. 验收命令：`pnpm vitest --run`。  

### 手工验收
1. 导入混合比例照片（含极端长图）后自动排版，观察四边无露底、图片间无缝隙、无重叠边。  
2. 进入裁剪模式，仅通过右侧滑条缩放可用；Shift+滚轮不再触发裁剪缩放。  
3. “当前选中”信息完整显示三套尺寸与比例，比例精度 2 位小数。  

### 风险与回滚
1. 风险：铺满算法改动涉及主线程+Worker 双路径，若只改一端会出现行为不一致。  
2. 风险：裁剪缩放输入改为百分比后，若映射公式与 clamp 不一致可能出现滑条值跳变。  
3. 回滚步骤：先回滚裁剪交互事件改动，再回滚铺满算法精确贴合改动，最后回滚信息展示改动。  

### 假设与默认值
1. “裁剪后尺寸”按你的确认展示两套：`crop` 与 `layoutCrop ?? crop`。  
2. 裁剪滑条范围按你的确认为 `100%~400%`。  
3. 本次仅处理 4 个 P0，不处理当前与需求无关的 `typecheck` 既有告警（`findHandleAt` 未使用）。  
4. 现有无关文件变更（如 `.template/*`）不纳入本次功能修复范围。  
